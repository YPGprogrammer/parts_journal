# Журнал запасных частей

Приложение для учета срока службы запчастей и планирования их замен. Разработано на базе фреймворка Streamlit.

## Описание проекта

Программа "Журнал запасных частей" предназначена для:
- Учета срока службы запчастей в оборудовании
- Мониторинга степени износа запчастей (зеленая/желтая/красная зоны)
- Планирования закупок запчастей с учетом сроков доставки
- Ведения журнала замен запчастей

### Функциональность

- **Dashboard**: Сводка по статусам износа, графики динамики износа, анализ наличия на складе
- **Parts**: CRUD операции для управления запчастями
- **Equipment**: CRUD операции для управления оборудованием
- **Replacements**: Журнал замен запчастей с историей установок
- **Procurement Plan**: Автоматический расчет плана закупок с датами инициирования

## Установка

### Требования

- Python 3.10+
- pip

### Локальная установка

1. Клонируйте репозиторий:
```bash
git clone <repository_url>
cd parts_journal
```

2. Создайте виртуальное окружение (рекомендуется):
```bash
python -m venv venv
source venv/bin/activate  # Linux/Mac
# или
venv\Scripts\activate  # Windows
```

3. Установите зависимости:
pip install -r requirements.txt

## Запуск

### Локальный запуск

streamlit run app/main.py

Приложение будет доступно по адресу: `http://localhost:8501`


## Архитектура и решения

### Структура проекта

parts_journal/
├── app/
├── main.py                  # Точка входа приложения
├── core/
│   ├── models.py            # SQLAlchemy модели (Equipment, Part, Workshop, ReplacementType, ReplacementLog)
│   ├── db.py                # Настройка подключения к БД (SQLite)
│   ├── services.py          # Бизнес-логика и сервисный слой
│   └── utils.py             # Утилиты для работы с БД в Streamlit
├── pages/                   # Страницы Streamlit
│   ├── 1_Dashboard.py       # Сводка и графики
│   ├── 2_Parts.py           # Управление запчастями
│   ├── 3_Equipment.py       # Управление оборудованием
│   ├── 4_Replacements.py    # Журнал замен
│   └── 5_ProcurementPlan.py # План закупок
├── data/                    # Директория для SQLite БД
└── requirements.txt         # Зависимости проекта


### Технологический стек

- **Streamlit** - веб-фреймворк для UI
- **SQLAlchemy 2.0** - ORM для работы с БД
- **SQLite** - встроенная БД (не требует отдельной установки)
- **Pandas** - обработка данных и агрегация
- **Matplotlib** - визуализация графиков

### Ключевые решения

#### 1. Архитектура данных

- **Нормализация БД**: Соблюдение 3NF с разделением на справочники (Equipment, Part, Workshop, ReplacementType) и журнал операций (ReplacementLog)
- **Relationships**: Использование SQLAlchemy relationships для удобной навигации между моделями
- **Constraints**: Check constraints для валидации данных на уровне БД (положительные значения, даты)

#### 2. Расчет износа

- **Зоны износа**:
  - Зеленая: > 25% остатка срока службы
  - Желтая: 10-25% остатка
  - Красная: < 10% остатка
- **Учет срока доставки**: Если запчасти нет на складе, срок доставки вычитается из оставшихся дней

#### 3. План закупок

- **Логика расчета**: Определение самой поздней даты инициации закупки, чтобы успеть получить запчасть до окончания срока службы
- **Даты закупки**: Запчасти закупаются 10-го и 25-го числа месяца, следующего за датой инициации
- **Учет срока доставки**: Дата получения = дата закупки + срок доставки

#### 4. Визуализация

- **Bar Chart**: Распределение запчастей по зонам износа
- **Line Chart**: Динамика износа по времени для каждого оборудования
- **Stacked Bar Chart**: Сравнение наличия на складе и потребности

#### 5. UI/UX

- **Многстраничность**: Использование директории `pages/` для автоматической навигации Streamlit
- **Формы**: `st.form` для всех операций создания/редактирования
- **Валидация**: Проверка данных на стороне клиента перед отправкой
- **Цветовая индикация**: Визуальное выделение зон износа в таблицах

### Модели данных

- **Equipment**: Оборудование (наименование, количество в парке)
- **Part**: Запчасть (наименование, срок службы, родительское оборудование, количество на складе, срок закупки)
- **Workshop**: Авторемонтная мастерская (наименование, адрес)
- **ReplacementType**: Тип замены (ремонт, плановая замена, внеплановая замена)
- **ReplacementLog**: Журнал замен (запчасть, оборудование, даты установки/замены, мастерская, тип замены)

## Использование

1. **Начните с добавления оборудования** (страница "Equipment")
2. **Добавьте запчасти** для оборудования (страница "Parts")
3. **Создайте мастерскую** при первом добавлении замены (страница "Replacements")
4. **Записывайте замены** запчастей в журнал (страница "Replacements")
5. **Мониторьте износ** на Dashboard с графиками и метриками
6. **Планируйте закупки** используя автоматически рассчитанный план (страница "Procurement Plan")

## Особенности

- Автоматическая инициализация типов замен при первом запуске
- Расчет износа с учетом наличия на складе и срока доставки
- Автоматический расчет плана закупок с оптимальными датами
- Визуализация данных через matplotlib
